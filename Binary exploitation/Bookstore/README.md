# Bookstore

## Category
Pwn

## Estimated difficulty
Hard

## Description
Heap challenge with old libc version (easier). Fastbin dup / double free. Overwrite the malloc hook with a one gadget, get shell.

## Scenario
I recently started an online bookstore. Can you check if it's secure?

## Write-up
The contestant is greeted with a menu of the management platform for an online bookstore. The user can add / edit / view / delete, indicating this is a heap challenge. The old libc version (2.23) means a lot of modern-day protections are not yet applied, making the challenge easier to solve. Playing around with all menu options and/or looking at the code with a disassembler shows a double free / fastbin dup vulnerability is present. Furthermore, a read-after-free is also present, making a libc leak as easy as allocating two (not too small) chunks, freeing the first, and looking at its contents with the provided function in the menu. Next, the fastbin dup / double free can be used to get two overlapping chunks, allowing to modify the address of the next to be allocated chunk. This is placed in front of the malloc hook. When this chunk is allocated, the malloc hook can be overwritten with a one gadget. Calling malloc one last time will trigger the one gadget and spawn a shell.

## Solve script
./Resources/solve.py

## Flag
CSC{H1pped3y_h0pp3dey_y0ur_stor3_is_n0w_my_prOp3rty!}

## Creator
Alex Van Mechelen

## Creator bio
Alex is a master student polytechnics at the Royal Military Academy. He is former contestant from the teams Royal Military Hackademy & DIG174L. He hopes you'll have a great time solving his challenges!