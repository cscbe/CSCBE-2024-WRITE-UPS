FROM ubuntu:20.04
RUN apt-get update && apt-get install -y build-essential && apt-get install -y socat && rm -rf /var/lib/apt/lists/*

RUN mkdir /app
COPY ./bin/ /app
WORKDIR /app

RUN gcc -o tictactoe tictactoe.c -fno-stack-protector -no-pie && rm tictactoe.c

WORKDIR /app

ENV FLAG="CSC{N0t_sO_Unb3at4ble_Aft3r_All!}"

RUN echo $FLAG > flag.txt

CMD ["socat", "tcp-l:1337,fork,reuseaddr", "exec:/app/tictactoe"]

EXPOSE 1337
